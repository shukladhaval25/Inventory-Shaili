Public Class frmTradingItemInward
    Inherits DevExpress.XtraEditors.XtraForm

#Region " Windows Form Designer generated code "

    Public Sub New()
        MyBase.New()

        'This call is required by the Windows Form Designer.
        InitializeComponent()

        'Add any initialization after the InitializeComponent() call

    End Sub

    'Form overrides dispose to clean up the component list.
    Protected Overloads Overrides Sub Dispose(ByVal disposing As Boolean)
        If disposing Then
            If Not (components Is Nothing) Then
                components.Dispose()
            End If
        End If
        MyBase.Dispose(disposing)
    End Sub

    'Required by the Windows Form Designer
    Private components As System.ComponentModel.IContainer

    'NOTE: The following procedure is required by the Windows Form Designer
    'It can be modified using the Windows Form Designer.  
    'Do not modify it using the code editor.
    Friend WithEvents GroupControl1 As DevExpress.XtraEditors.GroupControl
    Friend WithEvents Label1 As System.Windows.Forms.Label
    Friend WithEvents Label2 As System.Windows.Forms.Label
    Friend WithEvents GroupControl2 As DevExpress.XtraEditors.GroupControl
    Friend WithEvents txtRecNo As DevExpress.XtraEditors.TextEdit
    Friend WithEvents GroupControl3 As DevExpress.XtraEditors.GroupControl
    Friend WithEvents cmdCancel As DevExpress.XtraEditors.SimpleButton
    Friend WithEvents cmdSave As DevExpress.XtraEditors.SimpleButton
    Friend WithEvents lkupFG As DevExpress.XtraEditors.LookUpEdit
    Friend WithEvents Label3 As System.Windows.Forms.Label
    Friend WithEvents Label4 As System.Windows.Forms.Label
    Friend WithEvents grdInward As DevExpress.XtraGrid.GridControl
    Friend WithEvents gvInward As DevExpress.XtraGrid.Views.Grid.GridView
    Friend WithEvents Label5 As System.Windows.Forms.Label
    Friend WithEvents dtRecDate As DevExpress.XtraEditors.DateEdit
    Friend WithEvents txtunit As DevExpress.XtraEditors.TextEdit
    Friend WithEvents txtQty As DevExpress.XtraEditors.TextEdit
    Friend WithEvents cmdAdd As DevExpress.XtraEditors.SimpleButton
    Friend WithEvents cmdDelete As DevExpress.XtraEditors.SimpleButton
    Friend WithEvents Label6 As System.Windows.Forms.Label
    Friend WithEvents txtBatch As DevExpress.XtraEditors.TextEdit
    Friend WithEvents Label7 As System.Windows.Forms.Label
    Friend WithEvents lkupSupp As DevExpress.XtraEditors.LookUpEdit
    Friend WithEvents cmdReport As DevExpress.XtraEditors.SimpleButton
    Friend WithEvents cmdAddProd As DevExpress.XtraEditors.SimpleButton
    Friend WithEvents cmdAddSupplier As DevExpress.XtraEditors.SimpleButton
    <System.Diagnostics.DebuggerStepThrough()> Private Sub InitializeComponent()
        Me.GroupControl1 = New DevExpress.XtraEditors.GroupControl
        Me.cmdReport = New DevExpress.XtraEditors.SimpleButton
        Me.cmdCancel = New DevExpress.XtraEditors.SimpleButton
        Me.cmdSave = New DevExpress.XtraEditors.SimpleButton
        Me.GroupControl3 = New DevExpress.XtraEditors.GroupControl
        Me.txtBatch = New DevExpress.XtraEditors.TextEdit
        Me.Label6 = New System.Windows.Forms.Label
        Me.cmdDelete = New DevExpress.XtraEditors.SimpleButton
        Me.txtunit = New DevExpress.XtraEditors.TextEdit
        Me.Label5 = New System.Windows.Forms.Label
        Me.grdInward = New DevExpress.XtraGrid.GridControl
        Me.gvInward = New DevExpress.XtraGrid.Views.Grid.GridView
        Me.cmdAdd = New DevExpress.XtraEditors.SimpleButton
        Me.txtQty = New DevExpress.XtraEditors.TextEdit
        Me.Label4 = New System.Windows.Forms.Label
        Me.Label3 = New System.Windows.Forms.Label
        Me.lkupFG = New DevExpress.XtraEditors.LookUpEdit
        Me.GroupControl2 = New DevExpress.XtraEditors.GroupControl
        Me.cmdAddSupplier = New DevExpress.XtraEditors.SimpleButton
        Me.Label7 = New System.Windows.Forms.Label
        Me.lkupSupp = New DevExpress.XtraEditors.LookUpEdit
        Me.dtRecDate = New DevExpress.XtraEditors.DateEdit
        Me.txtRecNo = New DevExpress.XtraEditors.TextEdit
        Me.Label1 = New System.Windows.Forms.Label
        Me.Label2 = New System.Windows.Forms.Label
        Me.cmdAddProd = New DevExpress.XtraEditors.SimpleButton
        CType(Me.GroupControl1, System.ComponentModel.ISupportInitialize).BeginInit()
        Me.GroupControl1.SuspendLayout()
        CType(Me.GroupControl3, System.ComponentModel.ISupportInitialize).BeginInit()
        Me.GroupControl3.SuspendLayout()
        CType(Me.txtBatch.Properties, System.ComponentModel.ISupportInitialize).BeginInit()
        CType(Me.txtunit.Properties, System.ComponentModel.ISupportInitialize).BeginInit()
        CType(Me.grdInward, System.ComponentModel.ISupportInitialize).BeginInit()
        CType(Me.gvInward, System.ComponentModel.ISupportInitialize).BeginInit()
        CType(Me.txtQty.Properties, System.ComponentModel.ISupportInitialize).BeginInit()
        CType(Me.lkupFG.Properties, System.ComponentModel.ISupportInitialize).BeginInit()
        CType(Me.GroupControl2, System.ComponentModel.ISupportInitialize).BeginInit()
        Me.GroupControl2.SuspendLayout()
        CType(Me.lkupSupp.Properties, System.ComponentModel.ISupportInitialize).BeginInit()
        CType(Me.dtRecDate.Properties, System.ComponentModel.ISupportInitialize).BeginInit()
        CType(Me.txtRecNo.Properties, System.ComponentModel.ISupportInitialize).BeginInit()
        Me.SuspendLayout()
        '
        'GroupControl1
        '
        Me.GroupControl1.Controls.Add(Me.cmdReport)
        Me.GroupControl1.Controls.Add(Me.cmdCancel)
        Me.GroupControl1.Controls.Add(Me.cmdSave)
        Me.GroupControl1.Controls.Add(Me.GroupControl3)
        Me.GroupControl1.Controls.Add(Me.GroupControl2)
        Me.GroupControl1.Location = New System.Drawing.Point(8, 8)
        Me.GroupControl1.Name = "GroupControl1"
        Me.GroupControl1.Size = New System.Drawing.Size(440, 391)
        Me.GroupControl1.TabIndex = 0
        '
        'cmdReport
        '
        Me.cmdReport.Location = New System.Drawing.Point(8, 360)
        Me.cmdReport.Name = "cmdReport"
        Me.cmdReport.Size = New System.Drawing.Size(72, 24)
        Me.cmdReport.TabIndex = 6
        Me.cmdReport.Text = "&Report"
        Me.cmdReport.Visible = False
        '
        'cmdCancel
        '
        Me.cmdCancel.DialogResult = System.Windows.Forms.DialogResult.Cancel
        Me.cmdCancel.Location = New System.Drawing.Point(360, 360)
        Me.cmdCancel.Name = "cmdCancel"
        Me.cmdCancel.Size = New System.Drawing.Size(72, 24)
        Me.cmdCancel.TabIndex = 5
        Me.cmdCancel.Text = "&Cancel"
        '
        'cmdSave
        '
        Me.cmdSave.Location = New System.Drawing.Point(280, 360)
        Me.cmdSave.Name = "cmdSave"
        Me.cmdSave.Size = New System.Drawing.Size(72, 24)
        Me.cmdSave.TabIndex = 4
        Me.cmdSave.Text = "&Save"
        '
        'GroupControl3
        '
        Me.GroupControl3.Controls.Add(Me.cmdAddProd)
        Me.GroupControl3.Controls.Add(Me.txtBatch)
        Me.GroupControl3.Controls.Add(Me.Label6)
        Me.GroupControl3.Controls.Add(Me.cmdDelete)
        Me.GroupControl3.Controls.Add(Me.txtunit)
        Me.GroupControl3.Controls.Add(Me.Label5)
        Me.GroupControl3.Controls.Add(Me.grdInward)
        Me.GroupControl3.Controls.Add(Me.cmdAdd)
        Me.GroupControl3.Controls.Add(Me.txtQty)
        Me.GroupControl3.Controls.Add(Me.Label4)
        Me.GroupControl3.Controls.Add(Me.Label3)
        Me.GroupControl3.Controls.Add(Me.lkupFG)
        Me.GroupControl3.Location = New System.Drawing.Point(8, 88)
        Me.GroupControl3.Name = "GroupControl3"
        Me.GroupControl3.Size = New System.Drawing.Size(424, 266)
        Me.GroupControl3.TabIndex = 3
        '
        'txtBatch
        '
        Me.txtBatch.EditValue = ""
        Me.txtBatch.Location = New System.Drawing.Point(184, 80)
        Me.txtBatch.Name = "txtBatch"
        Me.txtBatch.Size = New System.Drawing.Size(72, 20)
        Me.txtBatch.TabIndex = 28
        '
        'Label6
        '
        Me.Label6.Location = New System.Drawing.Point(144, 80)
        Me.Label6.Name = "Label6"
        Me.Label6.Size = New System.Drawing.Size(40, 16)
        Me.Label6.TabIndex = 27
        Me.Label6.Text = "Batch:"
        '
        'cmdDelete
        '
        Me.cmdDelete.Location = New System.Drawing.Point(344, 80)
        Me.cmdDelete.Name = "cmdDelete"
        Me.cmdDelete.Size = New System.Drawing.Size(72, 24)
        Me.cmdDelete.TabIndex = 26
        Me.cmdDelete.Text = "&Delete"
        '
        'txtunit
        '
        Me.txtunit.EditValue = ""
        Me.txtunit.Location = New System.Drawing.Point(75, 80)
        Me.txtunit.Name = "txtunit"
        Me.txtunit.Size = New System.Drawing.Size(61, 20)
        Me.txtunit.TabIndex = 25
        '
        'Label5
        '
        Me.Label5.Location = New System.Drawing.Point(32, 80)
        Me.Label5.Name = "Label5"
        Me.Label5.Size = New System.Drawing.Size(40, 16)
        Me.Label5.TabIndex = 24
        Me.Label5.Text = "Unit:"
        '
        'grdInward
        '
        '
        '
        '
        Me.grdInward.EmbeddedNavigator.Name = ""
        Me.grdInward.Location = New System.Drawing.Point(7, 110)
        Me.grdInward.MainView = Me.gvInward
        Me.grdInward.Name = "grdInward"
        Me.grdInward.Size = New System.Drawing.Size(408, 149)
        Me.grdInward.TabIndex = 23
        Me.grdInward.ViewCollection.AddRange(New DevExpress.XtraGrid.Views.Base.BaseView() {Me.gvInward})
        '
        'gvInward
        '
        Me.gvInward.GridControl = Me.grdInward
        Me.gvInward.Name = "gvInward"
        Me.gvInward.OptionsCustomization.AllowGroup = False
        Me.gvInward.OptionsCustomization.AllowSort = False
        Me.gvInward.OptionsView.ShowGroupPanel = False
        '
        'cmdAdd
        '
        Me.cmdAdd.Location = New System.Drawing.Point(264, 80)
        Me.cmdAdd.Name = "cmdAdd"
        Me.cmdAdd.Size = New System.Drawing.Size(72, 24)
        Me.cmdAdd.TabIndex = 6
        Me.cmdAdd.Text = "&Add"
        '
        'txtQty
        '
        Me.txtQty.EditValue = ""
        Me.txtQty.Location = New System.Drawing.Point(330, 48)
        Me.txtQty.Name = "txtQty"
        Me.txtQty.Size = New System.Drawing.Size(86, 20)
        Me.txtQty.TabIndex = 3
        '
        'Label4
        '
        Me.Label4.Location = New System.Drawing.Point(288, 52)
        Me.Label4.Name = "Label4"
        Me.Label4.Size = New System.Drawing.Size(40, 24)
        Me.Label4.TabIndex = 2
        Me.Label4.Text = "Qty"
        '
        'Label3
        '
        Me.Label3.Location = New System.Drawing.Point(8, 52)
        Me.Label3.Name = "Label3"
        Me.Label3.Size = New System.Drawing.Size(64, 24)
        Me.Label3.TabIndex = 1
        Me.Label3.Text = "Product"
        '
        'lkupFG
        '
        Me.lkupFG.Location = New System.Drawing.Point(75, 48)
        Me.lkupFG.Name = "lkupFG"
        '
        '
        '
        Me.lkupFG.Properties.Buttons.AddRange(New DevExpress.XtraEditors.Controls.EditorButton() {New DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Combo)})
        Me.lkupFG.Properties.NullText = ""
        Me.lkupFG.Size = New System.Drawing.Size(205, 20)
        Me.lkupFG.TabIndex = 0
        '
        'GroupControl2
        '
        Me.GroupControl2.Controls.Add(Me.cmdAddSupplier)
        Me.GroupControl2.Controls.Add(Me.Label7)
        Me.GroupControl2.Controls.Add(Me.lkupSupp)
        Me.GroupControl2.Controls.Add(Me.dtRecDate)
        Me.GroupControl2.Controls.Add(Me.txtRecNo)
        Me.GroupControl2.Controls.Add(Me.Label1)
        Me.GroupControl2.Controls.Add(Me.Label2)
        Me.GroupControl2.Location = New System.Drawing.Point(8, 8)
        Me.GroupControl2.Name = "GroupControl2"
        Me.GroupControl2.Size = New System.Drawing.Size(424, 80)
        Me.GroupControl2.TabIndex = 2
        '
        'cmdAddSupplier
        '
        Me.cmdAddSupplier.Location = New System.Drawing.Point(352, 46)
        Me.cmdAddSupplier.Name = "cmdAddSupplier"
        Me.cmdAddSupplier.Size = New System.Drawing.Size(64, 24)
        Me.cmdAddSupplier.TabIndex = 5
        Me.cmdAddSupplier.Text = "Ad&d..."
        '
        'Label7
        '
        Me.Label7.Location = New System.Drawing.Point(8, 48)
        Me.Label7.Name = "Label7"
        Me.Label7.Size = New System.Drawing.Size(64, 24)
        Me.Label7.TabIndex = 5
        Me.Label7.Text = "Supplier:"
        '
        'lkupSupp
        '
        Me.lkupSupp.Location = New System.Drawing.Point(75, 48)
        Me.lkupSupp.Name = "lkupSupp"
        '
        '
        '
        Me.lkupSupp.Properties.Buttons.AddRange(New DevExpress.XtraEditors.Controls.EditorButton() {New DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Combo)})
        Me.lkupSupp.Properties.NullText = ""
        Me.lkupSupp.Size = New System.Drawing.Size(269, 20)
        Me.lkupSupp.TabIndex = 4
        '
        'dtRecDate
        '
        Me.dtRecDate.EditValue = Nothing
        Me.dtRecDate.Location = New System.Drawing.Point(304, 20)
        Me.dtRecDate.Name = "dtRecDate"
        '
        '
        '
        Me.dtRecDate.Properties.Buttons.AddRange(New DevExpress.XtraEditors.Controls.EditorButton() {New DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Combo)})
        Me.dtRecDate.Size = New System.Drawing.Size(112, 20)
        Me.dtRecDate.TabIndex = 3
        '
        'txtRecNo
        '
        Me.txtRecNo.EditValue = ""
        Me.txtRecNo.Location = New System.Drawing.Point(75, 20)
        Me.txtRecNo.Name = "txtRecNo"
        Me.txtRecNo.Size = New System.Drawing.Size(149, 20)
        Me.txtRecNo.TabIndex = 2
        '
        'Label1
        '
        Me.Label1.Location = New System.Drawing.Point(8, 24)
        Me.Label1.Name = "Label1"
        Me.Label1.Size = New System.Drawing.Size(72, 24)
        Me.Label1.TabIndex = 0
        Me.Label1.Text = "Receipt No.:"
        '
        'Label2
        '
        Me.Label2.Location = New System.Drawing.Point(232, 24)
        Me.Label2.Name = "Label2"
        Me.Label2.Size = New System.Drawing.Size(72, 24)
        Me.Label2.TabIndex = 1
        Me.Label2.Text = "Receipt Date:"
        '
        'cmdAddProd
        '
        Me.cmdAddProd.Location = New System.Drawing.Point(75, 18)
        Me.cmdAddProd.Name = "cmdAddProd"
        Me.cmdAddProd.Size = New System.Drawing.Size(205, 24)
        Me.cmdAddProd.TabIndex = 29
        Me.cmdAddProd.Text = "&New Product"
        '
        'frmTradingItemInward
        '
        Me.AutoScaleBaseSize = New System.Drawing.Size(5, 14)
        Me.CancelButton = Me.cmdCancel
        Me.ClientSize = New System.Drawing.Size(456, 404)
        Me.Controls.Add(Me.GroupControl1)
        Me.FormBorderStyle = System.Windows.Forms.FormBorderStyle.FixedSingle
        Me.MaximizeBox = False
        Me.MinimizeBox = False
        Me.Name = "frmTradingItemInward"
        Me.StartPosition = System.Windows.Forms.FormStartPosition.CenterScreen
        Me.Text = "Trading Item Inward"
        CType(Me.GroupControl1, System.ComponentModel.ISupportInitialize).EndInit()
        Me.GroupControl1.ResumeLayout(False)
        CType(Me.GroupControl3, System.ComponentModel.ISupportInitialize).EndInit()
        Me.GroupControl3.ResumeLayout(False)
        CType(Me.txtBatch.Properties, System.ComponentModel.ISupportInitialize).EndInit()
        CType(Me.txtunit.Properties, System.ComponentModel.ISupportInitialize).EndInit()
        CType(Me.grdInward, System.ComponentModel.ISupportInitialize).EndInit()
        CType(Me.gvInward, System.ComponentModel.ISupportInitialize).EndInit()
        CType(Me.txtQty.Properties, System.ComponentModel.ISupportInitialize).EndInit()
        CType(Me.lkupFG.Properties, System.ComponentModel.ISupportInitialize).EndInit()
        CType(Me.GroupControl2, System.ComponentModel.ISupportInitialize).EndInit()
        Me.GroupControl2.ResumeLayout(False)
        CType(Me.lkupSupp.Properties, System.ComponentModel.ISupportInitialize).EndInit()
        CType(Me.dtRecDate.Properties, System.ComponentModel.ISupportInitialize).EndInit()
        CType(Me.txtRecNo.Properties, System.ComponentModel.ISupportInitialize).EndInit()
        Me.ResumeLayout(False)

    End Sub

#End Region
    Public strcheck As String
    Dim dt As New DataTable

    Private Sub frmTradingItemInward_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        Try
            dt.Columns.Add("FID", System.Type.GetType("System.String"))
            dt.Columns.Add("Product", System.Type.GetType("System.String"))

            dt.Columns.Add("UnitID", System.Type.GetType("System.String"))
            dt.Columns.Add("Unit", System.Type.GetType("System.String"))
            dt.Columns.Add("QTY", System.Type.GetType("System.Double"))
            dt.Columns.Add("BatchID", System.Type.GetType("System.String"))

            FillLookup("SELECT  SupplierMaster.SuppName,SupplierMaster.SID FROM SupplierMaster", "Supplier", "Supplier", "sID", lkupSupp)
            Dim strTemp As String
            strTemp = "SELECT RMItemMaster.RMItemName as FGName, RMItemMaster.Rid as FID, UnitMaster.UnitID, UnitMaster.UnitName " _
                & " FROM RMItemMaster INNER JOIN UnitMaster ON RMItemMaster.UnitId = UnitMaster.UnitID " _
                & " GROUP BY RMItemMaster.RMItemName, RMItemMaster.Rid, UnitMaster.UnitID, UnitMaster.UnitName;"

            FillLookup("SELECT  FGMaster.FGName,FGMaster.FID, FGMaster.UnitID, UnitMaster.UnitName " _
                & " FROM FGMaster INNER JOIN UnitMaster ON FGMaster.UnitID = UnitMaster.UnitID " _
                & " GROUP BY FGMaster.FID, FGMaster.FGName, FGMaster.UnitID, UnitMaster.UnitName;", "FGmaster", "Product Name", "FID", lkupFG, "", strTemp)

            If strcheck = "Add" Then
                cmd = New OleDb.OleDbCommand
                cmd.Connection = conn
                cmd.CommandText = "select max(RecID) from TI_REc_Master"
                If IsDBNull(cmd.ExecuteScalar) = True Then
                    txtRecNo.Tag = 1
                Else
                    txtRecNo.Tag = Val(cmd.ExecuteScalar + 1)
                End If
                cmd.Dispose()
                dtRecDate.EditValue = Today
            Else
                cmd = New OleDb.OleDbCommand
                cmd.Connection = conn
                cmd.CommandText = "Select * from TI_REc_Master where RecID =" & ModMain.strgridid ' & " and CY ='" & strCY.Trim & "'"
                dr = cmd.ExecuteReader
                dr.Read()
                Bind_Data()

                cmd.Dispose()

                Dim sql As String

                sql = " SELECT FGMaster.FID, FGMaster.FGName as Product, FGMaster.UnitID, UnitMaster.UnitName as Unit, TI_Rec_Det.QTY,TI_Rec_Det.Batch_No as BatchID " _
                    & " FROM (TI_Rec_Det INNER JOIN FGMaster ON TI_Rec_Det.FID = FGMaster.FID) INNER JOIN UnitMaster ON FGMaster.UnitID = UnitMaster.UnitID " _
                    & " WHERE (((TI_Rec_Det.RecID)=" & ModMain.strgridid & "))" ' and TI_Rec_Det.CY ='" & strCY.Trim & "'"

                dt.Rows.Clear()
                Dim Adpt As New OleDb.OleDbDataAdapter(sql, conn)
                Adpt.Fill(dt)

                sql = " SELECT RMItemMaster.Rid as FID, RMItemMaster.RMItemName as Product, UnitMaster.UnitID, UnitMaster.UnitName as Unit, TI_Rec_Det.QTY, TI_Rec_Det.Batch_No as BatchID, TI_Rec_Det.RecID" _
                   & " FROM TI_Rec_Det INNER JOIN (UnitMaster INNER JOIN RMItemMaster ON UnitMaster.UnitID = RMItemMaster.UnitId) ON TI_Rec_Det.FID = RMItemMaster.Rid " _
                   & " WHERE (((TI_Rec_Det.RecID)=" & ModMain.strgridid & "))" ' and TI_Rec_Det.cy ='" & strCY.Trim & "';"


                Adpt.SelectCommand.CommandText = sql
                Adpt.Fill(dt)

                grdInward.DataSource = dt
                gvInward.Columns("FID").VisibleIndex = -1
                gvInward.Columns("UnitID").VisibleIndex = -1
                'GroupControl3.Enabled = False
                cmdReport.Visible = True
            End If
        Catch ex As Exception
            If show_error Then
                MsgBox(ex.ToString)
            End If
        End Try
    End Sub

    Private Sub Bind_Data()
        Try
            If IsDBNull(dr("RecID")) = False Then
                txtRecNo.Tag = dr("RecID")
            End If

            If IsDBNull(dr("RecNO")) = False Then
                txtRecNo.Text = dr("RecNo")
            End If

            If IsDBNull(dr("RecDate")) = False Then
                dtRecDate.EditValue = dr("RecDate")
            End If
            Dim strSupp As String = dr("SID")
            dr.Close()
            If strSupp.ToString = "" Then
                lkupSupp.EditValue = ""
            Else
                lkupSupp.EditValue = strSupp
            End If
        Catch ex As Exception
            If show_error Then
                MsgBox(ex.ToString)
            End If
        End Try
    End Sub

    Private Sub lkupFG_EditValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles lkupFG.EditValueChanged
        Try
            If lkupFG.EditValue <> "" Then
                Dim row As DataRowView = lkupFG.Properties.GetDataSourceRowByKeyValue(lkupFG.EditValue)
                lkupFG.Tag = row(1).ToString
                txtunit.Tag = row(2).ToString
                txtunit.Text = row(3).ToString
            End If
        Catch ex As Exception
            If show_error Then
                MessageBox.Show(ex.ToString)
            End If
        End Try
    End Sub

    Private Sub SimpleButton2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdAdd.Click
        If lkupFG.Text = "" Or txtQty.Text = "" Then
            MsgBox("Select product and enter qty.")
        Else
            Dim dr As DataRow
            Dim blnDup As Boolean = False
            For i As Int16 = 0 To gvInward.RowCount - 1
                If gvInward.GetRowCellValue(i, gvInward.Columns(1)).ToString = lkupFG.Text AndAlso _
                   gvInward.GetRowCellValue(i, gvInward.Columns(5)).ToString = txtBatch.Text.Trim Then
                    blnDup = True
                    Exit For
                End If
            Next
            If blnDup = False Then

                cmd = New OleDb.OleDbCommand
                cmd.Connection = conn
                cmd.CommandText = "SELECT Count(TI_Rec_Det.Batch_No) AS CountOfBatch_No, TI_Rec_Det.Batch_No, TI_Rec_Det.FID" _
                    & " FROM(TI_Rec_Det)GROUP BY TI_Rec_Det.Batch_No, TI_Rec_Det.FID;"

                cmd.CommandText = "SELECT Count(TI_Rec_Det.Batch_No) AS CountOfBatch_No FROM(TI_Rec_Det) " _
                    & " GROUP BY TI_Rec_Det.FID, TI_Rec_Det.Batch_No,TI_Rec_Det.CY HAVING (((TI_Rec_Det.FID)= '" & lkupFG.Tag & "') AND ((TI_Rec_Det.Batch_No)='" & txtBatch.Text.Trim & "')) and TI_REC_DET.CY ='" & strCY.Trim & "';"

                If cmd.ExecuteScalar = 0 Then
                    dr = dt.NewRow
                    dr.Item(0) = lkupFG.Tag
                    dr.Item(1) = lkupFG.Text
                    dr.Item(2) = txtunit.Tag
                    dr.Item(3) = txtunit.Text
                    dr.Item(4) = txtQty.Text
                    dr.Item("BatchID") = txtBatch.Text
                    dt.Rows.Add(dr)
                    grdInward.DataSource = dt
                    gvInward.Columns("FID").Visible = False
                    gvInward.Columns("UnitID").Visible = False
                Else
                    DevExpress.XtraEditors.XtraMessageBox.Show("Duplicate batch no", "Duplicate", MessageBoxButtons.OK, MessageBoxIcon.Information)
                End If
            End If
        End If
    End Sub
    Private Sub cmdCancel_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles cmdCancel.Click
        Me.Close()
    End Sub
    Private Sub cmdSave_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdSave.Click
        Try
            If CheckValidate() = True Then
                If strcheck = "Add" Then
                    cmd = New OleDb.OleDbCommand("insert into TI_Rec_Master values ( " & txtRecNo.Tag & ",'" & Replace(txtRecNo.Text.Trim, "'", "''") & "','" & dtRecDate.Text & "','" & lkupSupp.Tag & "','" & strCY.Trim & "')")
                    cmd.Connection = conn
                    cmd.Transaction = conn.BeginTransaction
                    cmd.ExecuteNonQuery()

                    For i As Int16 = 0 To gvInward.RowCount - 1
                        cmd.CommandText = "Insert into TI_Rec_Det values (" & txtRecNo.Tag & ",'" & gvInward.GetRowCellValue(i, "FID") & "'," & gvInward.GetRowCellValue(i, "QTY") & ",'" & gvInward.GetRowCellValue(i, "BatchID") & "','" & strCY.Trim & "')"
                        cmd.ExecuteNonQuery()

                        If gvInward.GetRowCellValue(i, "FID").ToString.StartsWith("RM") = True Then
                            cmd.CommandText = "Insert into RMStock values('" & gvInward.GetRowCellValue(i, "FID") & "','" & dtRecDate.Text & "','" & gvInward.GetRowCellValue(i, "BatchID") & "','Inward'," & gvInward.GetRowCellValue(i, "QTY") & ",0," & gvInward.GetRowCellValue(i, "QTY") & ",'" & strCY.Trim & "')"
                        Else
                            cmd.CommandText = "Insert into FGStock values('" & gvInward.GetRowCellValue(i, "FID") & "','" & dtRecDate.Text & "','" & gvInward.GetRowCellValue(i, "BatchID") & "','Inward'," & gvInward.GetRowCellValue(i, "QTY") & ",0,0," & gvInward.GetRowCellValue(i, "QTY") & ",'" & strCY.Trim & "')"
                        End If
                        cmd.ExecuteNonQuery()
                    Next
                    cmd.Transaction.Commit()
                ElseIf strcheck = "Edit" Then
                    cmd = New OleDb.OleDbCommand("update TI_Rec_Master set recNo = '" & Replace(txtRecNo.Text.Trim, "'", "''") & "', RecDate = '" & dtRecDate.Text & "',SID ='" & lkupSupp.Tag & "' where Recid = " & txtRecNo.Tag & " and CY ='" & strCY.Trim & "'")
                    cmd.Connection = conn
                    cmd.Transaction = conn.BeginTransaction
                    cmd.ExecuteNonQuery()

                    cmd.CommandText = "Delete From TI_Rec_Det WHERE RecID =" & txtRecNo.Tag & " and CY ='" & strCY.Trim & "'"
                    cmd.ExecuteNonQuery()

                    For i As Int16 = 0 To gvInward.RowCount - 1
                        cmd.CommandText = "Insert into TI_Rec_Det values (" & txtRecNo.Tag & ",'" & gvInward.GetRowCellValue(i, "FID") & "'," & gvInward.GetRowCellValue(i, "QTY") & ",'" & gvInward.GetRowCellValue(i, "BatchID") & "','" & strCY.Trim & "')"
                        cmd.ExecuteNonQuery()

                        If gvInward.GetRowCellValue(i, "FID").ToString.StartsWith("RM") = True Then
                            cmd.CommandText = "Select count(*) from RMStock where RID='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "FID") & "' and RMVI_NO ='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "BatchID") & "' and CY ='" & strCY.Trim & "'"
                            Dim intTemp As Integer
                            intTemp = cmd.ExecuteScalar
                            If intTemp >= 1 Then
                                'cmd.CommandText = "Insert into RMStock values('" & gvInward.GetRowCellValue(i, "FID") & "','" & dtRecDate.Text & "','" & cmd.CommandText = "Insert into TI_Rec_Det values (" & txtRecNo.Tag & ",'" & gvInward.GetRowCellValue(i, "FID") & "'," & gvInward.GetRowCellValue(i, "QTY") & ",'" & gvInward.GetRowCellValue(i, "BatchID") & "','Inward'," & gvInward.GetRowCellValue(i, "Qty") & ",0," & gvInward.GetRowCellValue(i, "Qty") & ")"
                                cmd.CommandText = "Update RMStock set Received_Qty = " & gvInward.GetRowCellValue(i, "QTY") & ",Balance_Qty = " & gvInward.GetRowCellValue(i, "QTY") & " where RID='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "FID") & "' and RMVI_NO ='" & gvInward.GetRowCellValue(i, "BatchID") & "' and CY ='" & strCY.Trim & "'"
                            Else
                                cmd.CommandText = "Insert into RMStock values('" & gvInward.GetRowCellValue(i, "FID") & "','" & dtRecDate.Text & "','" & gvInward.GetRowCellValue(i, "BatchID") & "','Inward'," & gvInward.GetRowCellValue(i, "QTY") & ",0," & gvInward.GetRowCellValue(i, "QTY") & ",'" & strCY.Trim & "')"
                            End If
                            cmd.ExecuteNonQuery()
                        Else
                            cmd.CommandText = "Select count(*) from FGStock where FID='" & gvInward.GetRowCellValue(i, "FID") & "' and Batch_No ='" & gvInward.GetRowCellValue(i, "BatchID") & "' and CY ='" & strCY.Trim & "'"
                            Dim intTemp As Integer
                            intTemp = cmd.ExecuteScalar
                            If intTemp >= 1 Then
                                cmd.CommandText = "Update FGStock set Received_Qty = " & gvInward.GetRowCellValue(i, "QTY") & ",Balance_Qty = " & gvInward.GetRowCellValue(i, "QTY") & "  where FID='" & gvInward.GetRowCellValue(i, "FID") & "' and Batch_No ='" & gvInward.GetRowCellValue(i, "BatchID") & "' and CY ='" & strCY.Trim & "'"
                            Else
                                cmd.CommandText = "Insert into FGStock values('" & gvInward.GetRowCellValue(i, "FID") & "','" & dtRecDate.Text & "','" & gvInward.GetRowCellValue(i, "BatchID") & "','Inward'," & gvInward.GetRowCellValue(i, "QTY") & ",0,0," & gvInward.GetRowCellValue(i, "QTY") & ",'" & strCY.Trim & "')"
                            End If
                            cmd.ExecuteNonQuery()
                        End If
                    Next
                    cmd.Transaction.Commit()
                End If
                cmdSave.Enabled = False
            Else
                Exit Sub
            End If
            DevExpress.XtraEditors.XtraMessageBox.Show(Me, "Save Data Successfully", StrAppName, MessageBoxButtons.OK, MessageBoxIcon.Information)
            Me.Close()
        Catch ex As Exception
            cmd.Transaction.Rollback()
            If show_error = True Then
                MessageBox.Show(ex.ToString)
            End If
        Finally
        End Try
    End Sub
    Private Function CheckValidate() As Boolean
        Dim strItemName As String
        Try
            cmd = New OleDb.OleDbCommand
            cmd.Connection = conn
            If strcheck = "Add" Then
                cmd.CommandText = "select recID from TI_Rec_Master where RecNo = '" & Replace(txtRecNo.Text, "'", "''") & "' and CY ='" & strCY.Trim & "'"
                strItemName = cmd.ExecuteScalar
            End If

            If strItemName <> "" And strcheck = "Add" Then
                DevExpress.XtraEditors.XtraMessageBox.Show(Me, "This receipt no already exists", StrAppName, MessageBoxButtons.OK, MessageBoxIcon.Information)
                Return False
                Exit Function
            End If
            If txtRecNo.Text = "" Or dtRecDate.Text = "" Then
                DevExpress.XtraEditors.XtraMessageBox.Show(Me, "Check either Receipt No or Date is not left blank", StrAppName, MessageBoxButtons.OK, MessageBoxIcon.Information)
                Return False
            End If
            Return True
        Catch ex As Exception
            If show_error Then
                MessageBox.Show(ex.ToString)
            End If
            Return False
        End Try
    End Function

    Private Sub cmdDelete_Click_1(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdDelete.Click
        Try
            If gvInward.GetSelectedRows.Length > 0 Then
                If strcheck = "Edit" Then
                    If gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "FID").ToString.StartsWith("RM") Then
                        cmd = New OleDb.OleDbCommand
                        cmd.CommandText = "Select Issue_Qty from RMStock where RID='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "FID") & "' and RMVI_NO ='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "BatchID") & "' and CY ='" & strCY.Trim & "'"
                        cmd.Connection = conn
                        Dim intIQ As Long
                        intIQ = cmd.ExecuteScalar
                        If intIQ > 0 Then
                            MessageBox.Show("You can not modify this data because qty all ready issue from this stock", "Stop Delete", MessageBoxButtons.OK, MessageBoxIcon.Stop)
                            Exit Sub
                        Else
                            If MessageBox.Show("Are you sure you want to delete this record? This will be update your stock also.", "Delete", MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then
                                Try
                                    cmd.Transaction = conn.BeginTransaction
                                    cmd.CommandText = "Delete from RMStock where RID='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "FID") & "' and RMVI_NO ='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "BatchID") & "' and CY ='" & strCY.Trim & "'"
                                    cmd.ExecuteNonQuery()

                                    cmd.CommandText = "Delete from TI_Rec_Det where RecID=" & txtRecNo.Tag & " and FID ='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "FID") & "' and BATCH_NO ='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "BatchID") & "' and CY ='" & strCY.Trim & "'"
                                    cmd.ExecuteNonQuery()
                                    cmd.Transaction.Commit()

                                    gvInward.DeleteRow(gvInward.FocusedRowHandle)
                                    gvInward.RefreshData()
                                Catch ex As Exception
                                    cmd.Transaction.Rollback()
                                End Try
                            End If
                        End If
                        cmd.Dispose()
                    Else
                        cmd = New OleDb.OleDbCommand
                        cmd.CommandText = "Select Issue_Qty from FGStock where FID='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "FID") & "' and BATCH_NO ='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "BatchID") & "' and CY ='" & strCY.Trim & "'"
                        cmd.Connection = conn
                        Dim intIQ As Long
                        intIQ = cmd.ExecuteScalar
                        If intIQ > 0 Then
                            MessageBox.Show("You can not modify this data because qty all ready issue from this stock", "Stop Delete", MessageBoxButtons.OK, MessageBoxIcon.Stop)
                            Exit Sub
                        Else
                            If MessageBox.Show("Are you sure you want to delete this record? This will be update your stock also.", "Delete", MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then
                                Try
                                    cmd.Transaction = conn.BeginTransaction
                                    cmd.CommandText = "Delete from FGStock where FID='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "FID") & "' and BATCH_NO ='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "BatchID") & "'  and CY ='" & strCY.Trim & "'"
                                    cmd.ExecuteNonQuery()

                                    cmd.CommandText = "Delete from TI_Rec_Det where RecID=" & txtRecNo.Tag & " and FID ='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "FID") & "' and BATCH_NO ='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "BatchID") & "' and CY ='" & strCY.Trim & "'"
                                    cmd.ExecuteNonQuery()
                                    cmd.Transaction.Commit()

                                Catch ex As Exception
                                    cmd.Transaction.Rollback()
                                End Try
                                gvInward.DeleteRow(gvInward.FocusedRowHandle)
                                gvInward.RefreshData()
                            End If
                        End If
                        cmd.Dispose()
                    End If
                ElseIf strcheck = "Add" Then
                    If MessageBox.Show("Are you sure you want to delete this record?", "Delete", MessageBoxButtons.YesNo, MessageBoxIcon.Question) = DialogResult.Yes Then
                        gvInward.DeleteRow(gvInward.FocusedRowHandle)
                        gvInward.RefreshData()
                    End If
                End If

            End If
        Catch ex As Exception
            If show_error Then
                MessageBox.Show(ex.ToString)
            End If
        End Try
    End Sub

    Private Sub lkupSupp_EditValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles lkupSupp.EditValueChanged
        Try
            If lkupSupp.EditValue <> "" Then
                Dim row As DataRowView = lkupSupp.Properties.GetDataSourceRowByKeyValue(lkupSupp.EditValue)
                lkupSupp.Tag = row(1).ToString
            End If
        Catch ex As Exception
            If show_error Then
                MessageBox.Show(ex.ToString)
            End If
        End Try
    End Sub

    Private Sub cmdReport_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdReport.Click
        Try
            Dim myPara As New frmPara
            myPara.ShowTI(txtRecNo.Tag & "'")
            myPara.Dispose()
        Catch ex As Exception
            If show_error Then
                MsgBox(ex.ToString)
            End If
        End Try
    End Sub

    Private Sub cmdAddSupplier_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdAddSupplier.Click
        Dim frmsupplier As New FrmSupplier
        frmsupplier.strcheck = "Add"
        frmsupplier.ShowDialog()
    End Sub

    Private Sub gvInward_CustomRowCellEdit(ByVal sender As Object, ByVal e As DevExpress.XtraGrid.Views.Grid.CustomRowCellEditEventArgs) Handles gvInward.CustomRowCellEdit
        Try
            If e.Column.FieldName = "QTY" Then
                If gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "FID").ToString.StartsWith("RM") Then
                    cmd = New OleDb.OleDbCommand
                    cmd.CommandText = "Select Issue_Qty from RMStock where RID='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "FID") & "' and RMVI_NO ='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "BatchID") & "' and CY ='" & strCY.Trim & "'"
                    cmd.Connection = conn
                    Dim intIQ As Long
                    intIQ = cmd.ExecuteScalar
                    If intIQ = 0 Then
                        gvInward.Columns("QTY").OptionsColumn.AllowEdit = True
                    Else
                        gvInward.Columns("QTY").OptionsColumn.AllowEdit = False
                    End If
                    cmd.Dispose()
                Else
                    cmd = New OleDb.OleDbCommand
                    cmd.CommandText = "Select Issue_Qty from FGStock where FID='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "FID") & "' and BATCH_NO ='" & gvInward.GetRowCellValue(gvInward.FocusedRowHandle, "BatchID") & "' and CY ='" & strCY.Trim & "'"
                    cmd.Connection = conn
                    Dim intIQ As Long
                    intIQ = cmd.ExecuteScalar
                    If intIQ = 0 Then
                        gvInward.Columns("QTY").OptionsColumn.AllowEdit = True
                    Else
                        gvInward.Columns("QTY").OptionsColumn.AllowEdit = False
                    End If
                    cmd.Dispose()
                End If
            Else
                e.Column.OptionsColumn.AllowEdit = False
            End If
        Catch ex As Exception
            If show_error Then
                MsgBox(ex.ToString)
            End If
        End Try
    End Sub

    Private Sub gvInward_FocusedRowChanged(ByVal sender As Object, ByVal e As DevExpress.XtraGrid.Views.Base.FocusedRowChangedEventArgs) Handles gvInward.FocusedRowChanged
        Try
            'cmd = New OleDb.OleDbCommand
            'cmd.Connection = conn
            'cmd.CommandText = "SELECT FGStock.Received_Qty, FGStock.Issue_Qty, FGStock.Ret_Qty, FGStock.Balance_Qty, FGStock.FID, FGStock.Batch_No " _
            '        & " FROM(FGStock) WHERE (((FGStock.FID)='" & gvInward.GetRowCellValue(e.PrevFocusedRowHandle, "FID") & "') AND ((FGStock.Batch_No)='" & gvInward.GetRowCellValue(e.PrevFocusedRowHandle, "BatchID") & "'));"

            'dr = cmd.ExecuteReader()
            'dr.Read()
            'If gvInward.GetRowCellValue(e.PrevFocusedRowHandle, "BatchID") < dr.Item("Issue_Qty") Then

            'End If
        Catch ex As Exception
        End Try
    End Sub

    Private Sub cmdAddProd_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdAddProd.Click
        Try
            Dim myfrm As New frmfgmaster
            myfrm.ShowDialog()
            myfrm.Dispose()
        Catch ex As Exception
            If show_error Then
                MsgBox(ex.ToString)
            End If
        End Try
    End Sub
End Class

